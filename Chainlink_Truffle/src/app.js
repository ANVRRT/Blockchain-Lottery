var Tx = require('ethereumjs-tx').Transaction
const Web3 = require('web3')
const web3 = new Web3('https://ropsten.infura.io/v3/5a1dcadd3e7a411ba675d48a72e650d7')
const PRIVATE_KEY = Buffer.from('MYPRIVATEKEY','hex')

const account = '0x392113e7C692108c16C2Bb642720D059066721D5'

web3.eth.getBalance(account, (err, bal) => {
    console.log('Acc balance: ', web3.utils.fromWei(bal, 'ether'))
})


web3.eth.getTransactionCount(account, (err, txCount) => {

    var governance = '0x392113e7C692108c16C2Bb642720D059066721D5'
    const data = '0x6080604052600160045566038d7ea4c68000600a5567016345785d8a0000600b5573aa1dc356dc4b18f30c347798fd5379f3d77abc5b600c60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507f3938323130356436393035303463356439636533373464303430633038363534600d553480156100a557600080fd5b50604051611889380380611889833981810160405260208110156100c857600080fd5b810190808051906020019092919050505060016007819055506001600660006101000a81548160ff0219169083600281111561010057fe5b021790555080600960006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050611733806101566000396000f3fe6080604052600436106100915760003560e01c8063c5e0b9fe11610059578063c5e0b9fe146101b9578063cf7b8c5f146101f2578063d9ad2b401461025e578063e97dcb6214610299578063f71d96cb146102a357610091565b80631c774d151461009657806322bb34d8146100d15780635aa6e6751461010c57806361cb9e2b146101635780639257b8f41461018e575b600080fd5b3480156100a257600080fd5b506100cf600480360360208110156100b957600080fd5b810190808035906020019092919050505061031e565b005b3480156100dd57600080fd5b5061010a600480360360208110156100f457600080fd5b810190808035906020019092919050505061047b565b005b34801561011857600080fd5b5061012161066d565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561016f57600080fd5b50610178610693565b6040518082815260200191505060405180910390f35b34801561019a57600080fd5b506101a3610699565b6040518082815260200191505060405180910390f35b3480156101c557600080fd5b506101ce6106a1565b604051808260028111156101de57fe5b60ff16815260200191505060405180910390f35b3480156101fe57600080fd5b506102076106b4565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561024a57808201518184015260208101905061022f565b505050509050019250505060405180910390f35b34801561026a57600080fd5b506102976004803603602081101561028157600080fd5b8101908080359060200190929190505050610742565b005b6102a1610952565b005b3480156102af57600080fd5b506102dc600480360360208110156102c657600080fd5b81019080803590602001909291905050506109f1565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6001600281111561032b57fe5b600660009054906101000a900460ff16600281111561034657fe5b146103b9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260148152602001807f4c6f7474657279206f70656e696e6720736f6f6e00000000000000000000000081525060200191505060405180910390fd5b6000600660006101000a81548160ff021916908360028111156103d857fe5b02179055506103e5611537565b6103f9600d54306322bb34d860e01b610a2d565b90506104476040518060400160405280600581526020017f756e74696c00000000000000000000000000000000000000000000000000000081525083420183610a5e9092919063ffffffff16565b610476600c60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1682600b54610a91565b505050565b806005600082815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610533576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260288152602001806116d66028913960400191505060405180910390fd5b6005600082815260200190815260200160002060006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055807f7cc135e0cebb02c3480ae5d74d377283180a2601f8f644edf7987b009316c63a60405160405180910390a2600060028111156105a357fe5b600660009054906101000a900460ff1660028111156105be57fe5b14610631576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601c8152602001807f546865204c6f7474657279206973206f70656e696e6720736f6f6e210000000081525060200191505060405180910390fd5b6002600660006101000a81548160ff0219169083600281111561065057fe5b0217905550600160075401600781905550610669610d49565b5050565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60075481565b600047905090565b600660009054906101000a900460ff1681565b6060600880548060200260200160405190810160405280929190818152602001828054801561073857602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190600101908083116106ee575b5050505050905090565b60028081111561074e57fe5b600660009054906101000a900460ff16600281111561076957fe5b146107bf576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260278152602001806116af6027913960400191505060405180910390fd5b60008111610835576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600a8152602001807f4e6f2072616e646f6d210000000000000000000000000000000000000000000081525060200191505060405180910390fd5b6000600880549050828161084557fe5b0690506008818154811061085557fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f193505050501580156108c5573d6000803e3d6000fd5b50600067ffffffffffffffff811180156108de57600080fd5b5060405190808252806020026020018201604052801561090d5781602001602082028036833780820191505090505b50600890805190602001906109239291906115a4565b506001600281111561093157fe5b600660009054906101000a900460ff16600281111561094c57fe5b50505050565b600a54341461095d57fe5b6000600281111561096a57fe5b600660009054906101000a900460ff16600281111561098557fe5b1461098c57fe5b6008339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550565b600881815481106109fe57fe5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610a35611537565b610a3d611537565b610a5485858584610ee1909392919063ffffffff16565b9150509392505050565b610a75828460800151610f9190919063ffffffff16565b610a8c818460800151610fb690919063ffffffff16565b505050565b600030600454604051602001808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660601b815260140182815260200192505050604051602081830303815290604052805190602001209050600454836060018181525050836005600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550807fb5e6e01e79f91267dc17b4e6314d5d4d03593d2ceee0fbb452b750bd70ea5af960405160405180910390a2600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634000aea08584610bc987610fc6565b6040518463ffffffff1660e01b8152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200183815260200180602001828103825283818151815260200191508051906020019080838360005b83811015610c50578082015181840152602081019050610c35565b50505050905090810190601f168015610c7d5780820380516001836020036101000a031916815260200191505b50945050505050602060405180830381600087803b158015610c9e57600080fd5b505af1158015610cb2573d6000803e3d6000fd5b505050506040513d6020811015610cc857600080fd5b8101908080519060200190929190505050610d2e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602381526020018061168c6023913960400191505060405180910390fd5b60016004600082825401925050819055508090509392505050565b600280811115610d5557fe5b600660009054906101000a900460ff166002811115610d7057fe5b14610dc6576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260278152602001806116af6027913960400191505060405180910390fd5b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663360131896040518163ffffffff1660e01b815260040160206040518083038186803b158015610e2e57600080fd5b505afa158015610e42573d6000803e3d6000fd5b505050506040513d6020811015610e5857600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663655b08eb6007546007546040518363ffffffff1660e01b81526004018083815260200182815260200192505050600060405180830381600087803b158015610ec757600080fd5b505af1158015610edb573d6000803e3d6000fd5b50505050565b610ee9611537565b610ef98560800151610100611192565b508385600001818152505082856020019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508185604001907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191690817bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191681525050849050949350505050565b610f9e82600383516111e6565b610fb1818361132b90919063ffffffff16565b505050565b610fc2826000836111e6565b5050565b6060634042994660e01b60008084600001518560200151866040015187606001516001896080015160000151604051602401808973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018881526020018781526020018673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001857bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19167bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916815260200184815260200183815260200180602001828103825283818151815260200191508051906020019080838360005b838110156110f55780820151818401526020810190506110da565b50505050905090810190601f1680156111225780820380516001836020036101000a031916815260200191505b509950505050505050505050604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050509050919050565b61119a61162e565b6000602083816111a657fe5b06146111bf57602082816111b657fe5b06602003820191505b81836020018181525050604051808452600081528281016020016040525082905092915050565b601781116112135761120d8160058460ff16901b60ff16178461134d90919063ffffffff16565b50611326565b60ff811161125557611238601860058460ff16901b178461134d90919063ffffffff16565b5061124f8160018561136d9092919063ffffffff16565b50611325565b61ffff81116112985761127b601960058460ff16901b178461134d90919063ffffffff16565b506112928160028561136d9092919063ffffffff16565b50611324565b63ffffffff81116112dd576112c0601a60058460ff16901b178461134d90919063ffffffff16565b506112d78160048561136d9092919063ffffffff16565b50611323565b67ffffffffffffffff811161132257611309601b60058460ff16901b178461134d90919063ffffffff16565b506113208160088561136d9092919063ffffffff16565b505b5b5b5b5b505050565b61133361162e565b6113458384600001515184855161138f565b905092915050565b61135561162e565b6113658384600001515184611448565b905092915050565b61137561162e565b611386848560000151518585611496565b90509392505050565b61139761162e565b82518211156113a557600080fd5b846020015182850111156113d0576113cf8560026113c988602001518887016114f7565b02611513565b5b6000808651805187602083010193508088870111156113ef5787860182525b60208701925050505b6020841061141b57805182526020820191506020810190506020840393506113f8565b60006001856020036101000a03905080198251168184511681811785525050879350505050949350505050565b61145061162e565b8360200151831061146d5761146c846002866020015102611513565b5b8351805160208583010184815381861415611489576001820183525b5050508390509392505050565b61149e61162e565b846020015184830111156114bc576114bb85600286850102611513565b5b60006001836101000a03905085518386820101858319825116178152815185880111156114e95784870182525b505085915050949350505050565b6000818311156115095782905061150d565b8190505b92915050565b6060826000015190506115268383611192565b50611531838261132b565b50505050565b6040518060a0016040528060008019168152602001600073ffffffffffffffffffffffffffffffffffffffff16815260200160007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191681526020016000815260200161159e61162e565b81525090565b82805482825590600052602060002090810192821561161d579160200282015b8281111561161c5782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550916020019190600101906115c4565b5b50905061162a9190611648565b5090565b604051806040016040528060608152602001600081525090565b61168891905b8082111561168457600081816101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555060010161164e565b5090565b9056fe756e61626c6520746f207472616e73666572416e6443616c6c20746f206f7261636c65546865204c6f7474657279206861736e27742063686f73656e20612077696e6e6572207965742e536f75726365206d75737420626520746865206f7261636c65206f66207468652072657175657374a2646970667358221220a92011292895bdf3d8ccf61a430544f5e6093510373b83ab61ee9fb83b3088cb64736f6c63430006060033'

    const txObject = {
        nonce: web3.utils.toHex(txCount),
        gasLimit: web3.utils.toHex(1000000),
        gasPrice: web3.utils.toHex(web3.utils.toWei('10','gwei')),
        _governance: governance,
        data: data
    }

    const tx = new Tx(txObject, { chain: 'ropsten' })
    tx.sign(PRIVATE_KEY)

    const serializedTx = tx.serialize()
    const raw = '0x' + serializedTx.toString('hex')

    web3.eth.sendSignedTransaction(raw, (err, txHash) => {
        console.log('err:', err, 'txHash:', txHash)
    })



})
